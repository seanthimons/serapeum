---
phase: 10-ui-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - R/mod_search_notebook.R
autonomous: true
must_haves:
  truths:
    - "User can collapse/expand the Journal Quality filter card to reclaim vertical space"
    - "User sees all badges (year, type, access, journal, block journal) aligned on the same baseline in abstract detail view"
  artifacts:
    - path: "R/mod_search_notebook.R"
      provides: "Collapsible journal quality card and aligned badges"
      contains: "collapse"
  key_links:
    - from: "R/mod_search_notebook.R"
      to: "R/mod_journal_filter.R"
      via: "mod_journal_filter_ui nested inside collapsible card"
      pattern: "mod_journal_filter_ui"
---

<objective>
Polish search notebook UI: make Journal Quality filter card collapsible and align all badges in abstract detail view.

Purpose: Improve UX by letting users reclaim vertical space and ensuring consistent visual alignment.
Output: Updated R/mod_search_notebook.R with both UI improvements.
</objective>

<execution_context>
@C:/Users/sxthi/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/sxthi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@R/mod_search_notebook.R
@R/mod_journal_filter.R
</context>

<tasks>

<task type="auto">
  <name>Task 1: Make Journal Quality filter card collapsible</name>
  <files>R/mod_search_notebook.R</files>
  <action>
In mod_search_notebook_ui (lines 117-127), wrap the Journal Quality card body in a Bootstrap collapse container so the card can be toggled open/closed.

Implementation approach: Use an HTML `data-bs-toggle="collapse"` attribute on the card header to toggle the card body visibility. This uses Bootstrap 5's native collapse component which is already available (bslib ships with Bootstrap 5).

Specifically:
1. Give the card_body a unique id using `ns("journal_quality_body")` and add `class = "collapse show"` so it starts expanded by default
2. Make the card_header clickable by adding `data-bs-toggle = "collapse"` and `data-bs-target` pointing to the body id
3. Add a small chevron icon (icon("chevron-down")) to the header that visually indicates collapsibility. Use CSS class `"float-end"` or position it in the existing flex layout
4. Add `style = "cursor: pointer;"` to the card header so users know it is clickable
5. Keep the "Manage blocklist" actionLink in the header functional (it must NOT be intercepted by the collapse toggle - wrap it in a `tags$span(onclick = "event.stopPropagation();")` to prevent the click from bubbling to the collapse toggle)

Do NOT use bslib::accordion - use raw Bootstrap 5 collapse for simplicity since this is a single card, not a group.
  </action>
  <verify>Run the app (`"C:\Program Files\R\R-4.5.1\bin\Rscript.exe" -e "shiny::runApp('app.R', port=3838)"`) and confirm the Journal Quality card header is clickable and toggles the body content. Verify the "Manage blocklist" link still opens the modal without triggering collapse.</verify>
  <done>Journal Quality card body can be collapsed and expanded by clicking the header. Card starts expanded by default. Manage blocklist link works independently.</done>
</task>

<task type="auto">
  <name>Task 2: Align badges on same baseline in abstract detail view</name>
  <files>R/mod_search_notebook.R</files>
  <action>
In the abstract detail view (output$abstract_detail renderUI, around lines 740-779), the badges for year, type, OA status, journal name, and "Block journal" are in a `div(class = "d-flex flex-wrap gap-2 mb-2", ...)`. The "Block journal" badge (actionLink wrapping a span with class "badge bg-danger") can misalign because actionLink generates an `<a>` tag with different default vertical alignment.

Fix:
1. Add `align-items-center` to the existing `d-flex flex-wrap gap-2 mb-2` class on the badges container div (line 748) so all items align on the same cross-axis baseline
2. On the "Block journal" actionLink (lines 772-778), add `style = "text-decoration: none; line-height: 1;"` to remove the underline and normalize line-height so the badge inside matches other badges
3. Ensure all badge spans use consistent sizing - check that no badge has extra margin or padding that would shift its vertical position

The key issue is that `<a>` tags (from actionLink) have different default styling than bare `<span>` tags. The fix is ensuring `align-items-center` on the flex container and normalizing the actionLink styling.
  </action>
  <verify>Run the app, click on a paper that has a venue/journal, and visually confirm all badges (year, type, OA, journal name, Block) sit on the same horizontal line without vertical offset.</verify>
  <done>All badges in abstract detail view are vertically aligned on the same baseline. No badge appears shifted up or down relative to others.</done>
</task>

</tasks>

<verification>
1. Open search notebook with papers loaded
2. Journal Quality card: click header to collapse, click again to expand - body toggles smoothly
3. Journal Quality card: click "Manage blocklist" link in header - modal opens without toggling collapse
4. Click a paper with a journal venue to see abstract detail
5. All badges (year, type, OA status, journal, Block) appear on the same horizontal line
</verification>

<success_criteria>
- Journal Quality filter card is collapsible via header click, starts expanded
- Manage blocklist link works independently of collapse toggle
- All abstract detail badges align consistently on the same baseline
- No regressions in existing search notebook functionality
</success_criteria>

<output>
After completion, create `.planning/phases/10-ui-polish/10-01-SUMMARY.md`
</output>
