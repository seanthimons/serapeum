---
phase: 16-ui-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - R/mod_document_notebook.R
  - app.R
autonomous: true

must_haves:
  truths:
    - "All 5 synthesis preset buttons display distinct icons (4 new icons on Summarize, Key Points, Study Guide, Outline + 1 existing on Slides)"
    - "Browser tab shows a Serapeum favicon"
    - "Sidebar footer uses fewer vertical pixels: costs link moved into consolidated footer rows, redundant hr() separators and empty spacer removed"
  artifacts:
    - path: "R/mod_document_notebook.R"
      provides: "Synthesis preset buttons with icons"
      contains: "icon.*file-lines|icon.*list-check|icon.*lightbulb|icon.*list-ol"
    - path: "app.R"
      provides: "Favicon link tags and optimized sidebar layout"
      contains: "favicon.ico"
    - path: "www/favicon.ico"
      provides: "Browser favicon file"
    - path: "www/favicon-32x32.png"
      provides: "PNG favicon for modern browsers"
    - path: "www/favicon-16x16.png"
      provides: "Small PNG favicon"
  key_links:
    - from: "app.R"
      to: "www/favicon.ico"
      via: "tags$link href"
      pattern: 'rel.*shortcut icon.*href.*favicon'
---

<objective>
Add distinct icons to synthesis preset buttons, implement a browser favicon, and optimize sidebar layout to reclaim vertical space.

Purpose: Complete three isolated UI polish items (UIPX-01, UIPX-02, UIPX-03) that improve visual consistency and space efficiency.
Output: Updated app.R with favicon + sidebar optimization, updated mod_document_notebook.R with preset icons, favicon files in www/.
</objective>

<execution_context>
@C:/Users/sxthi/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/sxthi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/16-ui-polish/16-RESEARCH.md
@app.R
@R/mod_document_notebook.R
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add preset icons and optimize sidebar layout</name>
  <files>R/mod_document_notebook.R, app.R</files>
  <action>
**Part A: Synthesis preset icons (R/mod_document_notebook.R)**

In the btn-group around lines 35-44, add `icon()` parameters to the four buttons that lack them:
- btn_summarize: add `icon = icon("file-lines")` (document with text metaphor)
- btn_keypoints: add `icon = icon("list-check")` (checked list metaphor)
- btn_studyguide: add `icon = icon("lightbulb")` (learning/ideas metaphor)
- btn_outline: add `icon = icon("list-ol")` (numbered list metaphor)
- btn_slides: already has `icon("file-powerpoint")` — leave unchanged

All 5 buttons will then have distinct icons.

**Part B: Sidebar layout optimization (app.R)**

Restructure the sidebar footer section (lines 98-153) to reduce vertical space. Key changes:
- Move the costs link into the consolidated footer (UIPX-03 requirement)
- Remove redundant `hr()` separators (keep only 1 of the current 3)
- Remove the empty `span()` spacer on the costs row

Consolidate lines 98-142 into a single compact footer div:
```r
hr(),
# Compact footer
div(
  class = "d-flex flex-column gap-2",
  # Row 1: Session cost
  div(
    class = "d-flex justify-content-between align-items-center",
    span(class = "text-muted small", icon("coins"), " Session:"),
    textOutput("session_cost_inline", inline = TRUE) |>
      tagAppendAttributes(class = "text-muted small fw-semibold")
  ),
  # Row 2: Settings + About
  div(
    class = "d-flex justify-content-between align-items-center",
    actionLink("settings_link", label = tagList(icon("gear"), "Settings"),
               class = "text-muted small"),
    actionLink("about_link", label = tagList(icon("info-circle"), "About"),
               class = "text-muted small")
  ),
  # Row 3: Costs + GitHub (costs link relocated here per UIPX-03)
  div(
    class = "d-flex justify-content-between align-items-center",
    actionLink("cost_link", label = tagList(icon("dollar-sign"), "Costs"),
               class = "text-muted small"),
    tags$a(
      href = "https://github.com/seanthimons/serapeum",
      target = "_blank",
      class = "text-muted small d-flex align-items-center gap-1",
      icon("github"), "GitHub"
    )
  ),
  # Row 4: Dark mode toggle (right-aligned)
  div(
    class = "d-flex justify-content-end",
    tags$button(
      id = "dark_mode_toggle",
      class = "btn btn-sm btn-outline-secondary",
      onclick = "
        const html = document.documentElement;
        const current = html.getAttribute('data-bs-theme');
        const next = current === 'dark' ? 'light' : 'dark';
        html.setAttribute('data-bs-theme', next);
        localStorage.setItem('theme', next);
        this.innerHTML = next === 'dark' ? '<i class=\"fa fa-sun\"></i>' : '<i class=\"fa fa-moon\"></i>';
      ",
      icon("moon")
    )
  )
),
```

3. Keep the theme restoration script (lines 144-153) after the footer div, unchanged.

Key changes from current layout:
- Remove 2 of 3 `hr()` elements (save ~40px)
- Remove the empty `span()` spacer on the costs row
- Move costs link into consolidated footer rows (UIPX-03)
- Add `small` class to Settings/About links for consistency
- Consolidate from 3 separate divs + 2 hr() into 1 div with gap-2
  </action>
  <verify>
Run the app with `Rscript -e "shiny::runApp('app.R', port=8080)"` and visually confirm:
1. All 5 synthesis preset buttons show distinct icons in the document notebook chat header
2. Sidebar footer is more compact with a single hr() separator
3. All footer links (Settings, About, Costs, GitHub) still work
4. Dark mode toggle still functions
5. Session cost still displays
  </verify>
  <done>
All 4 preset buttons without icons now have distinct Font Awesome icons (file-lines, list-check, lightbulb, list-ol), giving all 5 buttons distinct icons. Sidebar footer uses 1 hr() instead of 3, with costs link relocated into consolidated flex column layout and redundant elements removed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create and wire favicon</name>
  <files>app.R</files>
  <action>
**Step 1: Generate favicon files using R's png() device**

Use R's built-in `png()` graphics device (no extra packages needed) to generate a simple "S" lettermark favicon:

```r
# Generate 512x512 master image
png("www/favicon-master.png", width = 512, height = 512, bg = "transparent")
par(mar = c(0,0,0,0))
plot.new()
# Rounded-ish colored square
rect(0.02, 0.02, 0.98, 0.98, col = "#6366f1", border = NA)
# White "S" lettermark
text(0.5, 0.48, "S", cex = 18, col = "white", font = 2, family = "sans")
dev.off()

# Resize to 32x32 and 16x16 using png() at target sizes
for (size in c(32, 16)) {
  png(sprintf("www/favicon-%dx%d.png", size, size), width = size, height = size, bg = "transparent")
  par(mar = c(0,0,0,0))
  plot.new()
  rect(0.02, 0.02, 0.98, 0.98, col = "#6366f1", border = NA)
  text(0.5, 0.48, "S", cex = if (size == 32) 1.2 else 0.6, col = "white", font = 2, family = "sans")
  dev.off()
}

# For favicon.ico, copy the 32x32 PNG (browsers accept PNG-format .ico files)
file.copy("www/favicon-32x32.png", "www/favicon.ico", overwrite = TRUE)

# Clean up master
file.remove("www/favicon-master.png")
```

This is the concrete approach: R base graphics `png()` device, no external packages. The .ico file will be a renamed 32x32 PNG, which all modern browsers accept.

Place all generated files in `www/` directory. Ensure `www/` directory exists first (`dir.create("www", showWarnings = FALSE)`).

**Step 2: Add favicon link tags to app.R**

In the `tags$head()` block (currently starting at line 33), add favicon link tags BEFORE the existing `tags$style()`:

```r
tags$head(
    tags$link(rel = "shortcut icon", href = "favicon.ico"),
    tags$link(rel = "icon", type = "image/png", sizes = "32x32", href = "favicon-32x32.png"),
    tags$link(rel = "icon", type = "image/png", sizes = "16x16", href = "favicon-16x16.png"),
    tags$style(HTML("...")),  # existing styles
    ...
)
```

IMPORTANT: Do NOT prefix paths with "www/" — Shiny serves www/ contents at root automatically.
  </action>
  <verify>
1. Verify favicon files exist: `ls www/favicon*` should show 3 files
2. Verify app.R contains favicon link tags: grep for "favicon" in app.R
3. Run app and check browser tab shows an icon (hard refresh with Ctrl+Shift+R if cached)
  </verify>
  <done>
Browser tab displays a Serapeum favicon. Three favicon files exist in www/ (ico, 32px png, 16px png). Link tags in app.R correctly reference the files without "www/" prefix.
  </done>
</task>

</tasks>

<verification>
Phase-level verification:
1. App starts without errors: `Rscript -e "shiny::runApp('app.R', port=8080)"`
2. Document notebook chat header shows 5 preset buttons, each with a distinct icon
3. Browser tab shows favicon (not default browser icon)
4. Sidebar footer is visually more compact — single separator, consolidated rows, costs link in footer
5. All existing functionality preserved (links, dark mode, session cost)
</verification>

<success_criteria>
- UIPX-01: All 5 synthesis preset buttons have distinct, meaningful Font Awesome icons (4 new + 1 existing Slides)
- UIPX-02: Browser tab shows Serapeum favicon (ico + PNG variants in www/)
- UIPX-03: Sidebar footer uses 1 hr() instead of 3, costs link moved into consolidated d-flex layout, redundant elements removed, saving ~60-90px vertical space
</success_criteria>

<output>
After completion, create `.planning/phases/16-ui-polish/16-01-SUMMARY.md`
</output>
