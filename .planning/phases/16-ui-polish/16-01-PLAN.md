---
phase: 16-ui-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - R/mod_document_notebook.R
  - app.R
  - www/favicon.ico
  - www/favicon-32x32.png
  - www/favicon-16x16.png
autonomous: true

must_haves:
  truths:
    - "Synthesis preset buttons (Summarize, Key Points, Study Guide, Outline) each display a distinct icon"
    - "Browser tab shows a Serapeum favicon"
    - "Sidebar footer uses fewer vertical pixels with consolidated layout and fewer hr() separators"
  artifacts:
    - path: "R/mod_document_notebook.R"
      provides: "Synthesis preset buttons with icons"
      contains: "icon.*file-lines|icon.*list-check|icon.*lightbulb|icon.*list-ol"
    - path: "app.R"
      provides: "Favicon link tags and optimized sidebar layout"
      contains: "favicon.ico"
    - path: "www/favicon.ico"
      provides: "Browser favicon file"
    - path: "www/favicon-32x32.png"
      provides: "PNG favicon for modern browsers"
  key_links:
    - from: "app.R"
      to: "www/favicon.ico"
      via: "tags$link href"
      pattern: 'rel.*shortcut icon.*href.*favicon'
---

<objective>
Add distinct icons to synthesis preset buttons, implement a browser favicon, and optimize sidebar layout to reclaim vertical space.

Purpose: Complete three isolated UI polish items (UIPX-01, UIPX-02, UIPX-03) that improve visual consistency and space efficiency.
Output: Updated app.R with favicon + sidebar optimization, updated mod_document_notebook.R with preset icons, favicon files in www/.
</objective>

<execution_context>
@C:/Users/sxthi/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/sxthi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/16-ui-polish/16-RESEARCH.md
@app.R
@R/mod_document_notebook.R
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add preset icons and optimize sidebar layout</name>
  <files>R/mod_document_notebook.R, app.R</files>
  <action>
**Part A: Synthesis preset icons (R/mod_document_notebook.R)**

In the btn-group around lines 35-44, add `icon()` parameters to the four buttons that lack them:
- btn_summarize: add `icon = icon("file-lines")` (document with text metaphor)
- btn_keypoints: add `icon = icon("list-check")` (checked list metaphor)
- btn_studyguide: add `icon = icon("lightbulb")` (learning/ideas metaphor)
- btn_outline: add `icon = icon("list-ol")` (numbered list metaphor)
- btn_slides: already has `icon("file-powerpoint")` — leave unchanged

**Part B: Sidebar layout optimization (app.R)**

Restructure the sidebar footer section (lines 98-153) to reduce vertical space:

1. Remove the `hr()` at line 98 (before session cost). Keep only the `hr()` at line 106 as a single separator before the entire footer block.

2. Consolidate lines 98-142 into a single compact footer div:
```r
hr(),
# Compact footer
div(
  class = "d-flex flex-column gap-2",
  # Row 1: Session cost
  div(
    class = "d-flex justify-content-between align-items-center",
    span(class = "text-muted small", icon("coins"), " Session:"),
    textOutput("session_cost_inline", inline = TRUE) |>
      tagAppendAttributes(class = "text-muted small fw-semibold")
  ),
  # Row 2: Settings + About
  div(
    class = "d-flex justify-content-between align-items-center",
    actionLink("settings_link", label = tagList(icon("gear"), "Settings"),
               class = "text-muted small"),
    actionLink("about_link", label = tagList(icon("info-circle"), "About"),
               class = "text-muted small")
  ),
  # Row 3: Costs + GitHub
  div(
    class = "d-flex justify-content-between align-items-center",
    actionLink("cost_link", label = tagList(icon("dollar-sign"), "Costs"),
               class = "text-muted small"),
    tags$a(
      href = "https://github.com/seanthimons/serapeum",
      target = "_blank",
      class = "text-muted small d-flex align-items-center gap-1",
      icon("github"), "GitHub"
    )
  ),
  # Row 4: Dark mode toggle (right-aligned)
  div(
    class = "d-flex justify-content-end",
    tags$button(
      id = "dark_mode_toggle",
      class = "btn btn-sm btn-outline-secondary",
      onclick = "
        const html = document.documentElement;
        const current = html.getAttribute('data-bs-theme');
        const next = current === 'dark' ? 'light' : 'dark';
        html.setAttribute('data-bs-theme', next);
        localStorage.setItem('theme', next);
        this.innerHTML = next === 'dark' ? '<i class=\"fa fa-sun\"></i>' : '<i class=\"fa fa-moon\"></i>';
      ",
      icon("moon")
    )
  )
),
```

3. Keep the theme restoration script (lines 144-153) after the footer div, unchanged.

Key changes from current layout:
- Remove 2 of 3 `hr()` elements (save ~40px)
- Remove the empty `span()` spacer on the costs row
- Add `small` class to Settings/About links for consistency
- Consolidate from 3 separate divs + 2 hr() into 1 div with gap-2
  </action>
  <verify>
Run the app with `Rscript -e "shiny::runApp('app.R', port=8080)"` and visually confirm:
1. All 5 synthesis preset buttons show distinct icons in the document notebook chat header
2. Sidebar footer is more compact with a single hr() separator
3. All footer links (Settings, About, Costs, GitHub) still work
4. Dark mode toggle still functions
5. Session cost still displays
  </verify>
  <done>
All 4 preset buttons without icons now have distinct Font Awesome icons (file-lines, list-check, lightbulb, list-ol). Sidebar footer uses 1 hr() instead of 3, with all elements consolidated into a compact flex column layout.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create and wire favicon</name>
  <files>www/favicon.ico, www/favicon-32x32.png, www/favicon-16x16.png, app.R</files>
  <action>
**Step 1: Generate favicon files**

Create a simple favicon for Serapeum using R. Generate a 512x512 PNG with a book-open icon or "S" lettermark in the app's primary color (#6366f1), then convert to required sizes.

Use R's built-in png() device to create a simple "S" lettermark favicon:
- Background: #6366f1 (app primary color) with rounded corners
- Foreground: white "S" letter, bold
- Generate 3 files: favicon.ico (32x32), favicon-32x32.png, favicon-16x16.png

If R-based generation is too complex for good results, create a minimal SVG-based approach or use a simple colored square with "S" text. The key requirement is that SOMETHING recognizable appears in the browser tab.

Alternative approach if png() text rendering is poor: Use the `magick` package if available, or create the favicon by writing raw PNG bytes for a simple colored square (no text needed — even a solid #6366f1 square is better than nothing).

Place all generated files in `www/` directory.

**Step 2: Add favicon link tags to app.R**

In the `tags$head()` block (currently starting at line 33), add favicon link tags BEFORE the existing `tags$style()`:

```r
tags$head(
    tags$link(rel = "shortcut icon", href = "favicon.ico"),
    tags$link(rel = "icon", type = "image/png", sizes = "32x32", href = "favicon-32x32.png"),
    tags$link(rel = "icon", type = "image/png", sizes = "16x16", href = "favicon-16x16.png"),
    tags$style(HTML("...")),  # existing styles
    ...
)
```

IMPORTANT: Do NOT prefix paths with "www/" — Shiny serves www/ contents at root automatically.
  </action>
  <verify>
1. Verify favicon files exist: `ls www/favicon*` should show 3 files
2. Verify app.R contains favicon link tags: grep for "favicon" in app.R
3. Run app and check browser tab shows an icon (hard refresh with Ctrl+Shift+R if cached)
  </verify>
  <done>
Browser tab displays a Serapeum favicon. Three favicon files exist in www/ (ico, 32px png, 16px png). Link tags in app.R correctly reference the files without "www/" prefix.
  </done>
</task>

</tasks>

<verification>
Phase-level verification:
1. App starts without errors: `Rscript -e "shiny::runApp('app.R', port=8080)"`
2. Document notebook chat header shows 5 preset buttons, each with a distinct icon
3. Browser tab shows favicon (not default browser icon)
4. Sidebar footer is visually more compact — single separator, consolidated rows
5. All existing functionality preserved (links, dark mode, session cost)
</verification>

<success_criteria>
- UIPX-01: All 5 synthesis preset buttons have distinct, meaningful Font Awesome icons
- UIPX-02: Browser tab shows Serapeum favicon (ico + PNG variants in www/)
- UIPX-03: Sidebar footer uses 1 hr() instead of 3, with consolidated d-flex layout saving ~60-90px vertical space
</success_criteria>

<output>
After completion, create `.planning/phases/16-ui-polish/16-01-SUMMARY.md`
</output>
