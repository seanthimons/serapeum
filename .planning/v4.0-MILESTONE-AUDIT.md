---
milestone: v4.0
audited: 2026-02-20
status: passed
scores:
  requirements: 15/15
  phases: 4/4
  integration: 12/12
  flows: 4/4
gaps: none
tech_debt:
  - phase: 25-stabilize
    items:
      - "Secondary ragnar leak: ensure_ragnar_store() in mod_search_notebook.R L2061 — store opened for indexing but never explicitly closed"
      - "Pre-existing test failures: 13 tests fail due to missing schema columns (section_hint, doi) in test fixtures"
---

# v4.0 Stability + Synthesis — Milestone Audit

**Audited:** 2026-02-20 (re-audited after gap closure)
**Status:** passed
**Milestone Goal:** Stabilize the codebase after rapid v1.0–v3.0 shipping, then deliver the highest-value AI synthesis outputs leveraging v3.0's ragnar infrastructure.

## Requirements Coverage

| Requirement | Phase | Status | Notes |
|-------------|-------|--------|-------|
| BUGF-01 | 25 | SATISFIED | Seed paper inserted + pinned to row 1 |
| BUGF-02 | 25 | SATISFIED | Observer dedup prevents repeated modals |
| BUGF-03 | 25 | SATISFIED | Live pricing at startup via once=TRUE observer |
| BUGF-04 | 25 | SATISFIED | newly_added counter shows correct count |
| DEBT-01 | 25 | SATISFIED | own_store + on.exit in search_chunks_hybrid |
| DEBT-02 | 25 | SATISFIED | section_hint encoded with column presence guard |
| DEBT-03 | 25 | SATISFIED | with_ragnar_store + register_ragnar_cleanup deleted |
| UIPX-01 | 25 | SATISFIED | PR 112 observer dedup applied |
| UIPX-02 | 25 | SATISFIED | PR 115 collapsible keywords merged |
| UIPX-03 | 25 | SATISFIED | MutationObserver tooltip containment |
| UIPX-04 | 25 | SATISFIED | Theme-aware #e8e8ee / #1e1e2e background |
| UIPX-05 | 25 | SATISFIED | layout_columns(col_widths = c(6, 6)) |
| SYNTH-01 | 26 | SATISFIED | Overview popover with length/focus options in both notebook types |
| SYNTH-02 | 28 | SATISFIED | Lit Review Table with config bug fixed (get_setting accessor) |
| SYNTH-03 | 27 | SATISFIED | Research Questions with PICO framing |

**Score:** 15/15 requirements satisfied

## Phase Verification Summary

| Phase | Status | Score | Notes |
|-------|--------|-------|-------|
| 25: Stabilize | passed | 10/10 | All bugs fixed, tech debt resolved |
| 26: Unified Overview | passed | 3/3 | Overview popover replaces Summarize + Key Points |
| 27: Research Questions | passed | 3/3 | Standalone function, correctly wired |
| 28: Literature Review Table | passed | 7/7 | Config bug fixed, all connections verified |

**Score:** 4/4 phases verified

## Cross-Phase Integration

| Connection | Status |
|------------|--------|
| Phase 25 connection fix → Phase 27 search_chunks_hybrid | CONNECTED |
| Phase 25 connection fix → Phase 28 (direct SQL, no ragnar) | N/A (no dependency) |
| Phase 26 Overview → document notebook popover | CONNECTED |
| Phase 26 Overview → search notebook offcanvas preset row | CONNECTED |
| Phase 28 migration 008 → create_document metadata params | CONNECTED |
| Phase 28 import workflow → create_document metadata | CONNECTED |
| Phase 28 generate_lit_review_table → documents table metadata | CONNECTED |
| Phase 28 generate_lit_review_table → config extraction | CONNECTED (fixed) |
| Phase 27 disclaimer check (search notebook) | CONNECTED |
| Phase 28 disclaimer check (document notebook) | CONNECTED |
| Phase 28 CSS (.lit-review-scroll) vs .chat-markdown | No conflict |
| Phase 28 DOI injection → docs with doi column | CONNECTED |
| Phase 27 + 28 cost logging categories | CONNECTED |
| Phase 25 pricing observer → cost estimates | CONNECTED |

**Score:** 14/14 connections verified

## E2E Flows

| Flow | Status | Break Point |
|------|--------|-------------|
| Document → Overview (popover) | COMPLETE | — |
| Search → Overview (offcanvas) | COMPLETE | — |
| Search → Research Questions | COMPLETE | — |
| Search → Import → Lit Review | COMPLETE (config bug fixed) | — |
| Stabilize → Synthesis (connection safety) | COMPLETE | — |
| Cost tracking (all new presets) | COMPLETE | — |

**Score:** 6/6 flows complete

## Gap Closure Log

| Gap | Identified | Closed | Fix |
|-----|-----------|--------|-----|
| SYNTH-01: Phase 26 not executed | 2026-02-19 | 2026-02-20 | Phase 26 executed with popover UI in both notebook types |
| SYNTH-02: config$api_key flat access | 2026-02-19 | 2026-02-20 | Replaced with get_setting(config, "openrouter", "api_key") |

## Tech Debt (non-blocking)

### Phase 25
- Secondary ragnar leak: `ensure_ragnar_store()` in mod_search_notebook.R L2061 opens a store for indexing that is never explicitly closed
- 13 pre-existing test failures from missing schema columns in test fixtures

## Human Verification Pending

From phase verifications, these items need manual visual testing:
1. Citation network tooltip containment (Phase 25)
2. Citation network dark theme background (Phase 25)
3. Settings two-column layout balance (Phase 25)
4. Overview popover rendering in document notebook (Phase 26)
5. Overview popover rendering in search notebook offcanvas (Phase 26)
6. Lit Review table visual rendering in chat (Phase 28)
7. DOI link clickability (Phase 28)
8. AI disclaimer presence on all synthesis outputs (Phases 26-28)
9. Dark theme frozen column appearance (Phase 28)
10. Research Questions end-to-end UI flow (Phase 27)

---
*Originally audited: 2026-02-19 (gaps_found)*
*Re-audited: 2026-02-20 (passed — all gaps closed)*
*Auditor: Claude (gsd-audit-milestone)*
